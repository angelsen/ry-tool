# uv

Python package management with automated version workflows and full workspace support.

## Features

- **Workspace Support**: Full support for uv workspaces with multiple packages
- **Smart Package Detection**: Uses `tomllib` to read `pyproject.toml` directly
- **Package Validation**: Validates package names and suggests corrections for typos
- **Structured Dist Layout**: Each package builds to `dist/{package_name}/`
- **Token-Based Safety**: Review tokens for dangerous operations
- **Automated Workflows**: Version bumping, changelog updates, git tagging

## Installation

```bash
ry --install uv
```

## Usage

### Single Package Projects

```bash
# Version management
ry uv version --bump patch --dry-run     # Preview changes
BUMP_TOKEN=xxx ry uv version --bump patch # Execute bump

# Building
ry uv build                               # Builds to dist/{package_name}/

# Publishing
ry uv publish dist/{package_name}/* --dry-run
PUBLISH_TOKEN=xxx ry uv publish dist/{package_name}/*
```

### Workspace Projects

```bash
# Version management for workspace members
ry uv version --package backend --bump patch --dry-run
BUMP_TOKEN=xxx ry uv version --package backend --bump patch

# Building workspace packages
ry uv build --package backend            # Build specific package to dist/backend/
ry uv build --package frontend           # Build specific package to dist/frontend/
ry uv build --all-packages                # Build all workspace packages

# Publishing workspace packages
ry uv publish dist/backend/* --dry-run   # Verify backend package
PUBLISH_TOKEN=xxx ry uv publish dist/backend/*

# Nested packages work too
ry uv build --package some-package       # Builds packages/some-package to dist/some-package/
```

## Workspace Structure

The library automatically detects workspace structure from `pyproject.toml`:

```toml
[tool.uv.workspace]
members = [
    "backend",           # -> backend/pyproject.toml
    "frontend",          # -> frontend/pyproject.toml
    "packages/utils",    # -> packages/utils/pyproject.toml
]
```

### Changelog Support

Each package can have its own CHANGELOG.md:
```
project/
├── CHANGELOG.md              # Root package changelog
├── backend/
│   └── CHANGELOG.md          # Backend package changelog
├── frontend/
│   └── CHANGELOG.md          # Frontend package changelog
└── packages/
    └── utils/
        └── CHANGELOG.md      # Utils package changelog
```

### Build Output Structure

All packages build to organized directories:
```
dist/
├── my-app/                   # Root package builds here
│   ├── my-app-1.0.0.whl
│   └── my-app-1.0.0.tar.gz
├── backend/                  # Backend package builds here
│   ├── backend-0.1.0.whl
│   └── backend-0.1.0.tar.gz
└── utils/                    # Nested package uses just the name
    ├── utils-0.2.0.whl
    └── utils-0.2.0.tar.gz
```

## Smart Features

### Package Name Validation

The library validates package names and shows available options:
```bash
$ ry uv build --package invalid-name
ERROR: Unknown package 'invalid-name'

Available packages:
  - my-app (root)
  - backend (in backend/)
  - frontend (in frontend/)
  - utils (in packages/utils/)
```

### Workspace Status

The build command shows workspace status:
```bash
$ ry uv build --all-packages
Workspace project: my-app
Members: 3

Packages:
  - my-app v1.0.0 [root] [not built]
  - backend v0.1.0 [backend] [built]
  - frontend v0.2.0 [frontend] [not built]
  - utils v0.3.0 [packages/utils] [built]

INFO: Building all workspace packages
```

### Helpful Error Messages

When publishing without specifying files:
```bash
$ ry uv publish
ERROR: No files specified for publish

   Available packages to publish:
   - ry uv publish dist/backend/* --dry-run  # v0.1.0
   - ry uv publish dist/utils/* --dry-run    # v0.3.0

   Packages not yet built:
   - ry uv build --package frontend
   - ry uv build  # (root: my-app)
```

## Environment Variables

- `UV_PUBLISH_TOKEN`: PyPI token for publishing
- `BUMP_TOKEN`: Token for version bumping (generated by dry-run)
- `PUBLISH_TOKEN`: Token for publishing (generated by dry-run)

## Development

This library uses `tomllib` (Python 3.11+) to read workspace configuration directly from `pyproject.toml`, reducing subprocess calls and improving performance.

Key modules:
- `workspace_utils.py`: Workspace detection and package management
- `version_workflow.py`: Version management and changelog handling
- `token_manager.py`: Token generation and verification (from git library)

## See Also

- [uv documentation](https://github.com/astral-sh/uv)
- [ry documentation](https://github.com/your-org/ry)